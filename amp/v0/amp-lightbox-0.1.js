(window.AMP=window.AMP||[]).push(function(t){!function e(t,i,s){function n(a,o){if(!i[a]){if(!t[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return n(i?i:e)},u,u.exports,e,t,i,s)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<s.length;a++)n(s[a]);return n}({1:[function(e,i,s){var n=e("../../../src/gesture"),r=e("../../../src/layout"),a=e("../../../src/gesture-recognizers"),o=e("../../../src/history"),h=(e("../../../src/timer"),e("../../../src/style")),l=babelHelpers.interopRequireWildcard(h),u=function(t){function e(){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"isLayoutSupported",value:function(t){return t==r.Layout.NODISPLAY}},{key:"isReadyToBuild",value:function(){return null!=this.element.firstChild}},{key:"buildCallback",value:function(){var t=this;l.setStyles(this.element,{position:"fixed",zIndex:1e3,top:0,left:0,bottom:0,right:0});var e=this.getRealChildren();this.container_=document.createElement("div"),this.applyFillContent(this.container_),this.element.appendChild(this.container_),e.forEach(function(e){t.container_.appendChild(e)});var i=n.Gestures.get(this.element);this.element.addEventListener("click",function(){return t.close()}),i.onGesture(a.TapRecognizer,function(){return t.close()}),i.onGesture(a.SwipeXYRecognizer,function(){}),this.historyId_=-1}},{key:"layoutCallback",value:function(){return Promise.resolve()}},{key:"activate",value:function(){var t=this;this.requestFullOverlay(),this.getViewport().resetTouchZoom(),this.element.style.display="",this.element.style.opacity=0,this.element.style.transition="opacity 0.1s ease-in",requestAnimationFrame(function(){t.element.style.opacity=""}),this.scheduleLayout(this.container_),this.updateInViewport(this.container_,!0),this.getHistory_().push(this.close.bind(this)).then(function(e){t.historyId_=e})}},{key:"close",value:function(){this.cancelFullOverlay(),this.element.style.display="none",-1!=this.historyId_&&this.getHistory_().pop(this.historyId_)}},{key:"getHistory_",value:function(){return(0,o.historyFor)(this.element.ownerDocument.defaultView)}}]),e}(t.BaseElement);t.registerElement("amp-lightbox",u)},{"../../../src/gesture":6,"../../../src/gesture-recognizers":5,"../../../src/history":7,"../../../src/layout":8,"../../../src/style":16,"../../../src/timer":17}],2:[function(t,e,i){function s(){u=!1,o.length?l=o.concat(l):c=-1,l.length&&n()}function n(){if(!u){var t=setTimeout(s);u=!0;for(var e=l.length;e;){for(o=l,l=[];++c<e;)o&&o[c].run();c=-1,e=l.length}o=null,u=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function a(){}var o,h=e.exports={},l=[],u=!1,c=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new r(t,e)),1!==l.length||u||setTimeout(n,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],3:[function(t,e,i){function s(t,e,i){var s=void 0;if(!t){e=e||"Assertion failed";var a=e.split("%s"),o=a.shift(),h=o,l=[];r(l,o);for(var u=2;u<arguments.length;u++){var c=arguments[u];c&&c.tagName&&(s=c);var _=a.shift();l.push(c),r(l,_.trim()),h+=n(c)+_}var v=new Error(h);throw v.fromAssert=!0,v.associatedElement=s,v.messageArray=l,v}return t}function n(t){return t instanceof Element?t.tagName.toLowerCase()+(t.id?"#"+t.id:""):t}function r(t,e){""!=e&&t.push(e)}Object.defineProperty(i,"__esModule",{value:!0}),i.assert=s},{}],4:[function(t,e,i){function s(t){return"loading"!=t.readyState}function n(t,e){var i=s(t);i?e():!function(){var s=function(){"loading"!=t.readyState&&(i||(i=!0,e()),t.removeEventListener("readystatechange",s))};t.addEventListener("readystatechange",s)}()}function r(t){return new u(t)}function a(t){return(0,h.getService)(t,"documentState",function(){return r(t)})}Object.defineProperty(i,"__esModule",{value:!0}),i.isDocumentReady=s,i.onDocumentReady=n,i.documentStateFor=a;var o=t("./observable"),h=t("./service"),l=t("./style"),u=function(){function t(e){if(babelHelpers.classCallCheck(this,t),this.win=e,this.document_=e.document,this.hiddenProp_=(0,l.getVendorJsPropertyName)(this.document_,"hidden",!0),void 0===this.document_[this.hiddenProp_]&&(this.hiddenProp_=null),this.visibilityStateProp_=(0,l.getVendorJsPropertyName)(this.document_,"visibilityState",!0),void 0===this.document_[this.visibilityStateProp_]&&(this.visibilityStateProp_=null),this.visibilityObservable_=new o.Observable,this.visibilityChangeEvent_=null,this.hiddenProp_){this.visibilityChangeEvent_="visibilitychange";var i=this.hiddenProp_.indexOf("Hidden");-1!=i&&(this.visibilityChangeEvent_=this.hiddenProp_.substring(0,i)+"Visibilitychange")}this.boundOnVisibilityChanged_=this.onVisibilityChanged_.bind(this),this.visibilityChangeEvent_&&this.document_.addEventListener(this.visibilityChangeEvent_,this.boundOnVisibilityChanged_)}return babelHelpers.createClass(t,[{key:"cleanup_",value:function(){this.visibilityChangeEvent_&&this.document_.removeEventListener(this.visibilityChangeEvent_,this.boundOnVisibilityChanged_)}},{key:"isReady",value:function(){return s(this.document_)}},{key:"onReady",value:function(t){return n(this.document_,t)}},{key:"isHidden",value:function(){return this.hiddenProp_?this.document_[this.hiddenProp_]:!1}},{key:"getVisibilityState",value:function(){return this.visibilityStateProp_?this.document_[this.visibilityStateProp_]:this.isHidden()?"hidden":"visible"}},{key:"onVisibilityChanged",value:function(t){return this.visibilityObservable_.add(t)}},{key:"onVisibilityChanged_",value:function(){this.visibilityObservable_.fire()}}]),t}();i.DocumentState=u},{"./observable":12,"./service":15,"./style":16}],5:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var s=t("./gesture"),n=(t("./asserts"),t("./motion")),r=t("./timer"),a=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"tap",t),this.startX_=0,this.startY_=0,this.lastX_=0,this.lastY_=0}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"onTouchStart",value:function(t){var e=t.touches;return e&&1==e.length?(this.startX_=e[0].clientX,this.startY_=e[0].clientY,!0):!1}},{key:"onTouchMove",value:function(t){var e=t.changedTouches||t.touches;if(e&&1==e.length){this.lastX_=e[0].clientX,this.lastY_=e[0].clientY;var i=Math.abs(this.lastX_-this.startX_)>=8,s=Math.abs(this.lastY_-this.startY_)>=8;if(i||s)return!1}return!0}},{key:"onTouchEnd",value:function(t){this.signalReady(0)}},{key:"acceptStart",value:function(){this.signalEmit({clientX:this.lastX_,clientY:this.lastY_},null),this.signalEnd()}}]),e}(s.GestureRecognizer);i.TapRecognizer=a;var o=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"doubletap",t),this.startX_=0,this.startY_=0,this.lastX_=0,this.lastY_=0,this.tapCount_=0}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"onTouchStart",value:function(t){if(this.tapCount_>1)return!1;var e=t.touches;return e&&1==e.length?(this.startX_=e[0].clientX,this.startY_=e[0].clientY,!0):!1}},{key:"onTouchMove",value:function(t){var e=t.changedTouches||t.touches;if(e&&1==e.length){this.lastX_=e[0].clientX,this.lastY_=e[0].clientY;var i=Math.abs(this.lastX_-this.startX_)>=8,s=Math.abs(this.lastY_-this.startY_)>=8;if(i||s)return this.acceptCancel(),!1}return!0}},{key:"onTouchEnd",value:function(t){this.tapCount_++,this.tapCount_<2?this.signalPending(300):this.signalReady(0)}},{key:"acceptStart",value:function(){this.tapCount_=0,this.signalEmit({clientX:this.lastX_,clientY:this.lastY_},null),this.signalEnd()}},{key:"acceptCancel",value:function(){this.tapCount_=0}}]),e}(s.GestureRecognizer);i.DoubletapRecognizer=o;var h=function(t){function e(t,i,s,n){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,i),this.horiz_=s,this.vert_=n,this.eventing_=!1,this.startX_=0,this.startY_=0,this.lastX_=0,this.lastY_=0,this.prevX_=0,this.prevY_=0,this.startTime_=0,this.lastTime_=0,this.prevTime_=0,this.velocityX_=0,this.velocityY_=0}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"onTouchStart",value:function(t){var e=t.touches;return e&&1==e.length?(this.startTime_=r.timer.now(),this.startX_=e[0].clientX,this.startY_=e[0].clientY,!0):!1}},{key:"onTouchMove",value:function(t){var e=t.changedTouches||t.touches;if(e&&1==e.length){var i=e[0].clientX,s=e[0].clientY;if(this.lastX_=i,this.lastY_=s,this.eventing_)this.emit_(!1,!1,t);else{var n=Math.abs(i-this.startX_),r=Math.abs(s-this.startY_);if(this.horiz_&&this.vert_)(n>=8||r>=8)&&this.signalReady(-10);else if(this.horiz_){if(n>=8&&n>r)this.signalReady(-10);else if(r>=8)return!1}else{if(!this.vert_)return!1;if(r>=8&&r>n)this.signalReady(-10);else if(n>=8)return!1}}}return!0}},{key:"onTouchEnd",value:function(t){this.end_(t)}},{key:"acceptStart",value:function(){this.eventing_=!0,this.prevX_=this.startX_,this.prevY_=this.startY_,this.prevTime_=this.startTime_,this.startX_=this.lastX_,this.startY_=this.lastY_,this.emit_(!0,!1,null)}},{key:"acceptCancel",value:function(){this.eventing_=!1}},{key:"emit_",value:function(t,e,i){this.lastTime_=r.timer.now();var s=this.lastTime_-this.prevTime_;(!e&&s>4||e&&s>16)&&(this.velocityX_=(0,n.calcVelocity)(this.lastX_-this.prevX_,s,this.velocityX_),this.velocityY_=(0,n.calcVelocity)(this.lastY_-this.prevY_,s,this.velocityY_),this.velocityX_=Math.abs(this.velocityX_)>1e-4?this.velocityX_:0,this.velocityY_=Math.abs(this.velocityY_)>1e-4?this.velocityY_:0,this.prevX_=this.lastX_,this.prevY_=this.lastY_,this.prevTime_=this.lastTime_),this.signalEmit({first:t,last:e,time:this.lastTime_,deltaX:this.horiz_?this.lastX_-this.startX_:0,deltaY:this.vert_?this.lastY_-this.startY_:0,velocityX:this.horiz_?this.velocityX_:0,velocityY:this.vert_?this.velocityY_:0},i)}},{key:"end_",value:function(t){this.eventing_&&(this.eventing_=!1,this.emit_(!1,!0,t),this.signalEnd())}}]),e}(s.GestureRecognizer),l=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"swipe-xy",t,!0,!0)}return babelHelpers.inherits(e,t),e}(h);i.SwipeXYRecognizer=l;var u=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"swipe-x",t,!0,!1)}return babelHelpers.inherits(e,t),e}(h);i.SwipeXRecognizer=u;var c=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"swipe-y",t,!1,!0)}return babelHelpers.inherits(e,t),e}(h);i.SwipeYRecognizer=c;var _=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"tapzoom",t),this.eventing_=!1,this.startX_=0,this.startY_=0,this.lastX_=0,this.lastY_=0,this.tapX_=0,this.tapY_=0,this.tapCount_=0,this.prevX_=0,this.prevY_=0,this.startTime_=0,this.lastTime_=0,this.prevTime_=0,this.velocityX_=0,this.velocityY_=0}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"onTouchStart",value:function(t){if(this.eventing_)return!1;var e=t.touches;return e&&1==e.length?(this.startX_=e[0].clientX,this.startY_=e[0].clientY,!0):!1}},{key:"onTouchMove",value:function(t){var e=t.changedTouches||t.touches;if(e&&1==e.length)if(this.lastX_=e[0].clientX,this.lastY_=e[0].clientY,this.eventing_)this.emit_(!1,!1,t);else{var i=Math.abs(this.lastX_-this.startX_)>=8,s=Math.abs(this.lastY_-this.startY_)>=8;if(i||s){if(0==this.tapCount_)return this.acceptCancel(),!1;this.signalReady(0)}}return!0}},{key:"onTouchEnd",value:function(t){return this.eventing_?void this.end_(t):(this.tapCount_++,1==this.tapCount_?(this.signalPending(400),this.tapX_=this.lastX_,void(this.tapY_=this.lastY_)):void this.acceptCancel())}},{key:"acceptStart",value:function(){this.tapCount_=0,this.eventing_=!0,this.emit_(!0,!1,null)}},{key:"acceptCancel",value:function(){this.tapCount_=0,this.eventing_=!1}},{key:"emit_",value:function(t,e,i){this.lastTime_=r.timer.now(),t?(this.startTime_=this.lastTime_,this.velocityX_=this.velocityY_=0):this.lastTime_-this.prevTime_>2&&(this.velocityX_=(0,n.calcVelocity)(this.lastX_-this.prevX_,this.lastTime_-this.prevTime_,this.velocityX_),this.velocityY_=(0,n.calcVelocity)(this.lastY_-this.prevY_,this.lastTime_-this.prevTime_,this.velocityY_)),this.prevX_=this.lastX_,this.prevY_=this.lastY_,this.prevTime_=this.lastTime_,this.signalEmit({first:t,last:e,centerClientX:this.startX_,centerClientY:this.startY_,deltaX:this.lastX_-this.startX_,deltaY:this.lastY_-this.startY_,velocityX:this.velocityX_,velocityY:this.velocityY_},i)}},{key:"end_",value:function(t){this.eventing_&&(this.eventing_=!1,this.emit_(!1,!0,t),this.signalEnd())}}]),e}(s.GestureRecognizer);i.TapzoomRecognizer=_;var v=function(t){function e(t){babelHelpers.classCallCheck(this,e),babelHelpers.get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"pinch",t),this.eventing_=!1,this.startX1_=0,this.startY1_=0,this.startX2_=0,this.startY2_=0,this.lastX1_=0,this.lastY1_=0,this.lastX2_=0,this.lastY2_=0,this.prevDeltaX_=0,this.prevDeltaY_=0,this.centerClientX_=0,this.centerClientY_=0,this.startTime_=0,this.lastTime_=0,this.prevTime_=0,this.velocityX_=0,this.velocityY_=0}return babelHelpers.inherits(e,t),babelHelpers.createClass(e,[{key:"onTouchStart",value:function(t){var e=t.touches;return e&&2==e.length?(this.startTime_=r.timer.now(),this.startX1_=e[0].clientX,this.startY1_=e[0].clientY,this.startX2_=e[1].clientX,this.startY2_=e[1].clientY,!0):!1}},{key:"onTouchMove",value:function(t){var e=t.touches;if(!e||2!=e.length)return!1;if(this.lastX1_=e[0].clientX,this.lastY1_=e[0].clientY,this.lastX2_=e[1].clientX,this.lastY2_=e[1].clientY,this.eventing_)this.emit_(!1,!1,t);else{var i=this.lastX1_-this.startX1_,s=this.lastY1_-this.startY1_,n=this.lastX2_-this.startX2_,r=this.lastY2_-this.startY2_;if(0>=i*n&&0>=s*r)(Math.abs(i-n)>=8||Math.abs(s-r)>=8)&&this.signalReady(0);else if(Math.abs(i+n)>=8||Math.abs(s+r)>=8)return!1}return!0}},{key:"onTouchEnd",value:function(t){this.end_(t)}},{key:"acceptStart",value:function(){this.eventing_=!0,this.prevTime_=this.startTime_,this.prevDeltaX_=0,this.prevDeltaY_=0,this.centerClientX_=.5*(this.startX1_+this.startX2_),this.centerClientY_=.5*(this.startY1_+this.startY2_),this.emit_(!0,!1,null)}},{key:"acceptCancel",value:function(){this.eventing_=!1}},{key:"emit_",value:function(t,e,i){this.lastTime_=r.timer.now();var s=this.lastTime_-this.prevTime_,a=this.deltaX_(),o=this.deltaY_();(!e&&s>4||e&&s>16)&&(this.velocityX_=(0,n.calcVelocity)(a-this.prevDeltaX_,s,this.velocityX_),this.velocityY_=(0,n.calcVelocity)(o-this.prevDeltaY_,s,this.velocityY_),this.velocityX_=Math.abs(this.velocityX_)>1e-4?this.velocityX_:0,this.velocityY_=Math.abs(this.velocityY_)>1e-4?this.velocityY_:0,this.prevDeltaX_=a,this.prevDeltaY_=o,this.prevTime_=this.lastTime_);var h=this.sqDist_(this.startX1_,this.startX2_,this.startY1_,this.startY2_),l=this.sqDist_(this.lastX1_,this.lastX2_,this.lastY1_,this.lastY2_);this.signalEmit({first:t,last:e,time:this.lastTime_,centerClientX:this.centerClientX_,centerClientY:this.centerClientY_,dir:Math.sign(l-h),deltaX:.5*a,deltaY:.5*o,velocityX:.5*this.velocityX_,velocityY:.5*this.velocityY_},i)}},{key:"end_",value:function(t){this.eventing_&&(this.eventing_=!1,this.emit_(!1,!0,t),this.signalEnd())}},{key:"sqDist_",value:function(t,e,i,s){return(t-e)*(t-e)+(i-s)*(i-s)}},{key:"deltaX_",value:function(){return Math.abs(this.lastX1_-this.startX1_-(this.lastX2_-this.startX2_))}},{key:"deltaY_",value:function(){return Math.abs(this.lastY1_-this.startY1_-(this.lastY2_-this.startY2_))}}]),e}(s.GestureRecognizer);i.PinchRecognizer=v},{"./asserts":3,"./gesture":6,"./motion":11,"./timer":17}],6:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var s=t("./observable"),n=t("./asserts"),r=(t("./motion"),t("./pass")),a=t("./timer"),o="__AMP_Gestures",h=function c(t,e,i,s){babelHelpers.classCallCheck(this,c),this.type=t,this.data=e,this.time=i,this.event=s};i.Gesture=h;var l=function(){function t(e){babelHelpers.classCallCheck(this,t),this.element_=e,this.recognizers_=[],this.tracking_=[],this.ready_=[],this.pending_=[],this.eventing_=null,this.wasEventing_=!1,this.pass_=new r.Pass(this.doPass_.bind(this)),this.pointerDownObservable_=new s.Observable,this.overservers_=Object.create(null),this.boundOnTouchStart_=this.onTouchStart_.bind(this),this.boundOnTouchEnd_=this.onTouchEnd_.bind(this),this.boundOnTouchMove_=this.onTouchMove_.bind(this),this.boundOnTouchCancel_=this.onTouchCancel_.bind(this),this.element_.addEventListener("touchstart",this.boundOnTouchStart_),this.element_.addEventListener("touchend",this.boundOnTouchEnd_),this.element_.addEventListener("touchmove",this.boundOnTouchMove_),this.element_.addEventListener("touchcancel",this.boundOnTouchCancel_)}return babelHelpers.createClass(t,null,[{key:"get",value:function(e){var i=e[o];return i||(i=new t(e),e[o]=i),i}}]),babelHelpers.createClass(t,[{key:"cleanup",value:function(){this.element_.removeEventListener("touchstart",this.boundOnTouchStart_),this.element_.removeEventListener("touchend",this.boundOnTouchEnd_),this.element_.removeEventListener("touchmove",this.boundOnTouchMove_),this.element_.removeEventListener("touchcancel",this.boundOnTouchCancel_),this.pass_.cancel()}},{key:"onGesture",value:function(t,e){var i=new t(this),n=i.getType(),r=this.overservers_[n];return r||(this.recognizers_.push(i),r=new s.Observable,this.overservers_[n]=r),r.add(e)}},{key:"onPointerDown",value:function(t){return this.pointerDownObservable_.add(t)}},{key:"onTouchStart_",value:function(t){var e=a.timer.now();this.wasEventing_=!1,this.pointerDownObservable_.fire(t);for(var i=0;i<this.recognizers_.length;i++)this.ready_[i]||(this.pending_[i]&&this.pending_[i]<e&&this.stopTracking_(i),this.recognizers_[i].onTouchStart(t)&&this.startTracking_(i));this.afterEvent_(t)}},{key:"onTouchMove_",value:function(t){for(var e=a.timer.now(),i=0;i<this.recognizers_.length;i++)this.tracking_[i]&&(this.pending_[i]&&this.pending_[i]<e?this.stopTracking_(i):this.recognizers_[i].onTouchMove(t)||this.stopTracking_(i));this.afterEvent_(t)}},{key:"onTouchEnd_",value:function(t){for(var e=a.timer.now(),i=0;i<this.recognizers_.length;i++)this.tracking_[i]&&(this.pending_[i]&&this.pending_[i]<e?this.stopTracking_(i):(this.recognizers_[i].onTouchEnd(t),(!this.pending_[i]||this.pending_[i]<e)&&this.stopTracking_(i)));this.afterEvent_(t)}},{key:"onTouchCancel_",value:function(t){for(var e=0;e<this.recognizers_.length;e++)this.cancelEventing_(e);this.afterEvent_(t)}},{key:"signalReady_",value:function(t,e){if(this.eventing_)return void t.acceptCancel();for(var i=a.timer.now(),s=0;s<this.recognizers_.length;s++)this.recognizers_[s]==t&&(this.ready_[s]=i+e,this.pending_[s]=0);this.passAfterEvent_=!0}},{key:"signalPending_",value:function(t,e){if(this.eventing_)return void t.acceptCancel();for(var i=a.timer.now(),s=0;s<this.recognizers_.length;s++)this.recognizers_[s]==t&&(this.pending_[s]=i+e)}},{key:"signalEnd_",value:function(t){this.eventing_==t&&(this.eventing_=null,this.wasEventing_=!0)}},{key:"signalEmit_",value:function(t,e,i){(0,n.assert)(this.eventing_==t,"Recognizer is not currently allowed: %s",t.getType());var s=this.overservers_[t.getType()];s&&s.fire(new h(t.getType(),e,a.timer.now(),i))}},{key:"afterEvent_",value:function(t){var e=!!this.eventing_||this.wasEventing_;if(this.wasEventing_=!1,!e)for(var i=a.timer.now(),s=0;s<this.recognizers_.length;s++)if(this.ready_[s]||this.pending_[s]&&this.pending_[s]>=i){e=!0;break}e&&(t.stopPropagation(),t.preventDefault()),this.passAfterEvent_&&(this.passAfterEvent_=!1,this.doPass_())}},{key:"doPass_",value:function(){for(var t=a.timer.now(),e=-1,i=0;i<this.recognizers_.length;i++)this.ready_[i]?(-1==e||this.ready_[i]>this.ready_[e])&&(e=i):this.pending_[i]&&this.pending_[i]<t&&this.stopTracking_(i);if(-1!=e){for(var s=0,i=0;i<this.recognizers_.length;i++)!this.ready_[i]&&this.tracking_[i]&&(s=Math.max(s,this.pending_[i]-t));return 2>s?void this.startEventing_(e):void this.pass_.schedule(s)}}},{key:"startEventing_",value:function(t){for(var e=this.recognizers_[t],i=0;i<this.recognizers_.length;i++)i!=t&&this.cancelEventing_(i);this.ready_[t]=0,this.pending_[t]=0,this.eventing_=e,e.acceptStart()}},{key:"startTracking_",value:function(t){this.tracking_[t]=!0,this.pending_[t]=0}},{key:"stopTracking_",value:function(t){this.tracking_[t]=!1,this.pending_[t]=0,this.ready_[t]||this.recognizers_[t].acceptCancel()}},{key:"cancelEventing_",value:function(t){this.ready_[t]=0,this.stopTracking_(t)}}]),t}();i.Gestures=l;var u=function(){function t(e,i){babelHelpers.classCallCheck(this,t),this.type_=e,this.manager_=i}return babelHelpers.createClass(t,[{key:"getType",value:function(){return this.type_}},{key:"signalReady",value:function(t){this.manager_.signalReady_(this,t)}},{key:"signalPending",value:function(t){this.manager_.signalPending_(this,t)}},{key:"signalEnd",value:function(){this.manager_.signalEnd_(this)}},{key:"signalEmit",value:function(t,e){this.manager_.signalEmit_(this,t,e)}},{key:"acceptStart",value:function(){}},{key:"acceptCancel",value:function(){}},{key:"onTouchStart",value:function(t){return!1}},{key:"onTouchMove",value:function(t){return!1}},{key:"onTouchEnd",value:function(t){}}]),t}();i.GestureRecognizer=u},{"./asserts":3,"./motion":11,"./observable":12,"./pass":13,"./timer":17}],7:[function(t,e,i){function s(t){var e={};return e[v]=t,e}function n(t){var e=(0,c.viewerFor)(t),i=void 0;return i=e.isOvertakeHistory()?new f(e):new p(t),new d(i)}function r(t){return(0,h.getService)(t,"history",function(){return n(t)})}Object.defineProperty(i,"__esModule",{value:!0}),i.historyFor=r;var a=t("./pass"),o=t("./asserts"),h=t("./service"),l=t("./log"),u=t("./timer"),c=t("./viewer"),_="History",v="AMP.History",d=function(){function t(e){babelHelpers.classCallCheck(this,t),this.binding_=e,this.stackIndex_=0,this.stackOnPop_=[],this.queue_=[],this.binding_.setOnStackIndexUpdated(this.onStackIndexUpdated_.bind(this))}return babelHelpers.createClass(t,[{key:"cleanup_",value:function(){this.binding_.cleanup_()}},{key:"push",value:function(t){var e=this;return this.enque_(function(){return e.binding_.push().then(function(i){return e.onStackIndexUpdated_(i),t&&(e.stackOnPop_[i]=t),i})})}},{key:"pop",value:function(t){var e=this;return this.enque_(function(){return e.binding_.pop(t).then(function(t){e.onStackIndexUpdated_(t)})})}},{key:"onStackIndexUpdated_",value:function(t){this.stackIndex_=t,this.doPop_()}},{key:"doPop_",value:function(){if(!(this.stackIndex_>=this.stackOnPop_.length-1)){for(var t=[],e=this.stackOnPop_.length-1;e>this.stackIndex_;e--)this.stackOnPop_[e]&&(t.push(this.stackOnPop_[e]),this.stackOnPop_[e]=void 0);if(this.stackOnPop_.splice(this.stackIndex_+1),t.length>0)for(var e=0;e<t.length;e++)u.timer.delay(t[e],1)}}},{key:"enque_",value:function(t){var e=void 0,i=void 0,s=new Promise(function(t,s){e=t,i=s});return this.queue_.push({callback:t,resolve:e,reject:i}),1==this.queue_.length&&this.deque_(),s}},{key:"deque_",value:function(){var t=this;if(0!=this.queue_.length){var e=this.queue_[0],i=void 0;try{i=e.callback()}catch(s){i=Promise.reject(s)}i.then(function(t){e.resolve(t)},function(t){l.log.error(_,"failed to execute a task:",t),e.reject(t)}).then(function(){t.queue_.splice(0,1),t.deque_()})}}}]),t}();i.History=d;var p=(function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,[{key:"cleanup_",value:function(){}},{key:"setOnStackIndexUpdated",value:function(t){}},{key:"push",value:function(){}},{key:"pop",value:function(t){}}]),t}(),function(){function t(e){var i=this;babelHelpers.classCallCheck(this,t),this.win=e;var n=this.win.history;this.startIndex_=n.length-1,n.state&&void 0!==n.state[v]&&(this.startIndex_=Math.min(n.state[v],this.startIndex_)),this.stackIndex_=this.startIndex_,this.waitingState_,this.onStackIndexUpdated_=null,this.supportsState_="state"in n,this.unsupportedState_=s(this.stackIndex_);var r=void 0,o=void 0;n.pushState&&n.replaceState?(this.origPushState_=n.pushState.bind(n),this.origReplaceState_=n.replaceState.bind(n),r=function(t,e,s){i.unsupportedState_=t,i.origPushState_(t,e,s)},o=function(t,e,s){i.unsupportedState_=t,void 0!==s?i.origReplaceState_(t,e,s):i.origReplaceState_(t,e)}):(r=function(t,e,s){i.unsupportedState_=t},o=function(t,e,s){i.unsupportedState_=t}),this.pushState_=r,this.replaceState_=o;try{this.replaceState_(s(this.stackIndex_))}catch(h){l.log.error(_,"Initial replaceState failed: "+h.message)}n.pushState=this.historyPushState_.bind(this),n.replaceState=this.historyReplaceState_.bind(this);var u=new a.Pass(this.onHistoryEvent_.bind(this),50);this.popstateHandler_=function(t){l.log.fine(_,"popstate event: "+i.win.history.length+", "+JSON.stringify(t.state)),u.schedule()},this.hashchangeHandler_=function(){l.log.fine(_,"hashchange event: "+i.win.history.length+", "+i.win.location.hash),u.schedule()},this.win.addEventListener("popstate",this.popstateHandler_),this.win.addEventListener("hashchange",this.hashchangeHandler_)}return babelHelpers.createClass(t,[{key:"cleanup_",value:function(){this.origPushState_&&(this.win.history.pushState=this.origPushState_),this.origReplaceState_&&(this.win.history.replaceState=this.origReplaceState_),this.win.removeEventListener("popstate",this.popstateHandler_),this.win.removeEventListener("hashchange",this.hashchangeHandler_)}},{key:"setOnStackIndexUpdated",value:function(t){this.onStackIndexUpdated_=t}},{key:"push",value:function(){var t=this;return this.whenReady_(function(){return t.historyPushState_(),Promise.resolve(t.stackIndex_)})}},{key:"pop",value:function(t){var e=this;return t=Math.max(t,this.startIndex_),this.whenReady_(function(){return e.back_(e.stackIndex_-t+1)})}},{key:"backTo",value:function(t){var e=this;return t=Math.max(t,this.startIndex_),this.whenReady_(function(){return e.back_(e.stackIndex_-t)})}},{key:"onHistoryEvent_",value:function(){var t=this.getState_();l.log.fine(_,"history event: "+this.win.history.length+", "+JSON.stringify(t));var e=t?t[v]:void 0,i=this.stackIndex_,s=this.waitingState_;this.waitingState_=void 0,i>this.win.history.length-2&&(i=this.win.history.length-2,this.updateStackIndex_(i)),void 0==e?i+=1:i=e<this.win.history.length?e:this.win.history.length-1,t||(t={}),t[v]=i,this.replaceState_(t,void 0,void 0),i!=this.stackIndex_&&this.updateStackIndex_(i),i<this.startIndex_&&(this.startIndex_=i),s&&s.resolve()}},{key:"getState_",value:function(){return this.supportsState_?this.win.history.state:this.unsupportedState_}},{key:"assertReady_",value:function(){(0,o.assert)(!this.waitingState_,"The history must not be in the waiting state")}},{key:"whenReady_",value:function(t){return this.waitingState_?this.waitingState_.promise.then(t,t):t()}},{key:"wait_",value:function(){this.assertReady_();var t=void 0,e=void 0,i=u.timer.timeoutPromise(500,new Promise(function(i,s){t=i,e=s}));return this.waitingState_={promise:i,resolve:t,reject:e},i}},{key:"back_",value:function(t){var e=this;if(this.assertReady_(),0>=t)return Promise.resolve(this.stackIndex_);this.unsupportedState_=s(this.stackIndex_-t);var i=this.wait_();return this.win.history.go(-t),i.then(function(){return Promise.resolve(e.stackIndex_)})}},{key:"historyPushState_",value:function(t,e,i){this.assertReady_(),t||(t={});var s=(this.win.history.length,this.stackIndex_+1);t[v]=s,this.pushState_(t,e,i),s!=this.win.history.length-1&&(s=this.win.history.length-1,t[v]=s,this.replaceState_(t)),this.updateStackIndex_(s)}},{key:"historyReplaceState_",value:function(t,e,i){this.assertReady_(),t||(t={});var s=Math.min(this.stackIndex_,this.win.history.length-1);t[v]=s,this.replaceState_(t,e,i),this.updateStackIndex_(s)}},{key:"updateStackIndex_",value:function(t){this.assertReady_(),t=Math.min(t,this.win.history.length-1),this.stackIndex_!=t&&(l.log.fine(_,"stack index changed: "+this.stackIndex_+" -> "+t),this.stackIndex_=t,this.onStackIndexUpdated_&&this.onStackIndexUpdated_(t))}}]),t}());i.HistoryBindingNatural_=p;var f=function(){function t(e){babelHelpers.classCallCheck(this,t),this.viewer_=e,this.stackIndex_=0,this.onStackIndexUpdated_=null,this.unlistenOnHistoryPopped_=this.viewer_.onHistoryPoppedEvent(this.onHistoryPopped_.bind(this))}return babelHelpers.createClass(t,[{key:"cleanup_",value:function(){this.unlistenOnHistoryPopped_()}},{key:"setOnStackIndexUpdated",value:function(t){this.onStackIndexUpdated_=t}},{key:"push",value:function(){return this.updateStackIndex_(this.stackIndex_+1),this.viewer_.postPushHistory(this.stackIndex_),Promise.resolve(this.stackIndex_)}},{key:"pop",value:function(t){return t>this.stackIndex_?Promise.resolve(this.stackIndex_):(this.viewer_.postPopHistory(t),this.updateStackIndex_(t-1),Promise.resolve(this.stackIndex_))}},{key:"onHistoryPopped_",value:function(t){this.updateStackIndex_(t.newStackIndex)}},{key:"updateStackIndex_",value:function(t){this.stackIndex_!=t&&(l.log.fine(_,"stack index changed: "+this.stackIndex_+" -> "+t),this.stackIndex_=t,this.onStackIndexUpdated_&&this.onStackIndexUpdated_(t))}}]),t}();i.HistoryBindingVirtual_=f},{"./asserts":3,"./log":9,"./pass":13,"./service":15,"./timer":17,"./viewer":19}],8:[function(t,e,i){function s(t){for(var e in p)if(p[e]==t)return p[e];return void 0}function n(t){return"-amp-layout-"+t}function r(t){return t==p.FIXED||t==p.FIXED_HEIGHT||t==p.RESPONSIVE||t==p.FILL}function a(t){var e="string"==typeof t?t:t.tagName;return e&&0==e.toLowerCase().indexOf("i-")}function o(t){return"number"==typeof t?t+"px":t&&/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax)?$/.test(t)?/^\d+(\.\d+)?$/.test(t)?t+"px":t:void 0}function h(t){return(0,d.assert)(/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax)$/.test(t),"Invalid length value: %s",t),t}function l(t){h(t);var e=(0,d.assert)(t.match(/[a-z]+/i),"Failed to read units from %s",t);return e[0]}function u(t){return parseFloat(t)}function c(t){return t=t.toUpperCase(),void 0!==f[t]}function _(t){if(t=t.toUpperCase(),!f[t]){var e=t.replace(/^AMP\-/,""),i=document.createElement(e);i.controls=!0,i.style.position="absolute",i.style.visibility="hidden",document.body.appendChild(i),f[t]={width:i.offsetWidth||1,height:i.offsetHeight||1},document.body.removeChild(i)}return f[t]}function v(t){return y[t.toUpperCase()]||!1}Object.defineProperty(i,"__esModule",{value:!0}),i.parseLayout=s,i.getLayoutClass=n,i.isLayoutSizeDefined=r,i.isInternalElement=a,i.parseLength=o,i.assertLength=h,i.getLengthUnits=l,i.getLengthNumeral=u,i.hasNaturalDimensions=c,i.getNaturalDimensions=_,i.isLoadingAllowed=v;var d=t("./asserts"),p={NODISPLAY:"nodisplay",FIXED:"fixed",FIXED_HEIGHT:"fixed-height",RESPONSIVE:"responsive",CONTAINER:"container",FILL:"fill"};i.Layout=p;var f={"AMP-PIXEL":{width:1,height:1},"AMP-AUDIO":null};i.naturalDimensions_=f;var y={"AMP-ANIM":!0,"AMP-IFRAME":!0,"AMP-IMG":!0,"AMP-INSTAGRAM":!0,"AMP-PINTEREST":!0,"AMP-VIDEO":!0};i.LOADING_ELEMENTS_=y},{"./asserts":3}],9:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var s=t("./mode"),n=(new Date).getTime(),r=function(){function t(e){babelHelpers.classCallCheck(this,t),
this.win=e.AMP_TEST?e.parent:e,this.isEnabled_=this.shouldBeEnabled_()}return babelHelpers.createClass(t,[{key:"shouldBeEnabled_",value:function(){if(!this.win.console||!this.win.console.log)return!1;var t=this.win.location.hash.match(/log=(\d)/),e=t&&t[1];return(0,s.getMode)().localDev&&"0"!=e?!0:this.win.location.hash&&"1"==e?!0:!1}},{key:"msg_",value:function(t,e,i){if(this.isEnabled_){var s=this.win.console.log;"ERROR"==e?s=this.win.console.error||s:"INFO"==e?s=this.win.console.info||s:"WARN"==e&&(s=this.win.console.warn||s),i.unshift((new Date).getTime()-n,"["+t+"]"),s.apply(this.win.console,i)}}},{key:"fine",value:function(t,e){this.isEnabled_&&this.msg_(t,"FINE",Array.prototype.slice.call(arguments,1))}},{key:"info",value:function(t,e){this.isEnabled_&&this.msg_(t,"INFO",Array.prototype.slice.call(arguments,1))}},{key:"warn",value:function(t,e){this.isEnabled_&&this.msg_(t,"WARN",Array.prototype.slice.call(arguments,1))}},{key:"error",value:function(t,e){this.isEnabled_&&this.msg_(t,"ERROR",Array.prototype.slice.call(arguments,1))}}]),t}();i.Log=r;var a=new r(window);i.log=a},{"./mode":10}],10:[function(t,e,i){(function(e){function s(){return o?o:o=r()}function n(t){o=t}function r(){var t=("localhost"==location.hostname||location.ancestorOrigins&&location.ancestorOrigins[0]&&0==location.ancestorOrigins[0].indexOf("http://localhost:"))&&!!document.querySelector('script[src*="/dist/"],script[src*="/base/"]'),i=(0,a.parseQueryString)(location.hash).development,s=void 0!=i?"1"==i:!!document.querySelector("script[development]");return{localDev:t,development:s,minified:"production"==e.env.NODE_ENV,test:window.AMP_TEST}}Object.defineProperty(i,"__esModule",{value:!0}),i.getMode=s,i.setModeForTesting=n;var a=t("./url"),o=null}).call(this,t("_process"))},{"./url":18,_process:2}],11:[function(t,e,i){function s(t,e,i){1>e&&(e=1);var s=t/e,n=.5+Math.min(e/c,.5);return s*n+i*(1-n)}function n(t,e,i,s,n,r){return new _(t,e,i,s,n,r).start_()}Object.defineProperty(i,"__esModule",{value:!0}),i.calcVelocity=s,i.continueMotion=n;var r=(t("./asserts"),t("./timer")),a=t("./vsync"),o=function(){},h=.02,l=16.67,u=Math.round(-l/Math.log(.95)),c=2*l,_=function(){function t(e,i,s,n,o,h){var l=this;babelHelpers.classCallCheck(this,t),this.vsync_=h||(0,a.vsyncFor)(window),this.callback_=o,this.lastX_=e,this.lastY_=i,this.maxVelocityX_=s,this.maxVelocityY_=n,this.velocityX_=0,this.velocityY_=0,this.startTime_=r.timer.now(),this.lastTime_=this.startTime_,this.resolve_,this.reject_,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e})}return babelHelpers.createClass(t,[{key:"start_",value:function(){return this.continuing_=!0,Math.abs(this.maxVelocityX_)<=h&&Math.abs(this.maxVelocityY_)<=h?(this.fireMove_(),this.completeContinue_(!0)):this.runContinuing_(),this}},{key:"halt",value:function(){this.continuing_&&this.completeContinue_(!1)}},{key:"then",value:function(t,e){return t||e?this.promise_.then(t,e):this.promise_}},{key:"thenAlways",value:function(t){var e=t||o;return this.then(e,e)}},{key:"runContinuing_",value:function(){this.velocityX_=this.maxVelocityX_,this.velocityY_=this.maxVelocityY_;var t=this.stepContinue_.bind(this),e=this.completeContinue_.bind(this,!0);return this.vsync_.runMutateSeries(t,5e3).then(e,e)}},{key:"stepContinue_",value:function(t,e){if(!this.continuing_)return!1;this.lastX_,this.lastY_;if(this.lastTime_=r.timer.now(),this.lastX_+=e*this.velocityX_,this.lastY_+=e*this.velocityY_,!this.fireMove_())return!1;var i=Math.exp(-t/u);return this.velocityX_=this.maxVelocityX_*i,this.velocityY_=this.maxVelocityY_*i,Math.abs(this.velocityX_)>h||Math.abs(this.velocityY_)>h}},{key:"completeContinue_",value:function(t){this.continuing_&&(this.continuing_=!1,this.lastTime_=r.timer.now(),this.fireMove_(),t?this.resolve_():this.reject_())}},{key:"fireMove_",value:function(){return this.callback_(this.lastX_,this.lastY_)}}]),t}()},{"./asserts":3,"./timer":17,"./vsync":20}],12:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(){babelHelpers.classCallCheck(this,t),this.handlers_=[]}return babelHelpers.createClass(t,[{key:"add",value:function(t){var e=this;return this.handlers_.push(t),function(){e.remove(t)}}},{key:"remove",value:function(t){for(var e=0;e<this.handlers_.length;e++)if(t==this.handlers_[e]){this.handlers_.splice(e,1);break}}},{key:"fire",value:function(t){this.handlers_.forEach(function(e){e(t)})}},{key:"getHandlerCount",value:function(){return this.handlers_.length}}]),t}();i.Observable=s},{}],13:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var s=t("./timer"),n=function(){function t(e,i){babelHelpers.classCallCheck(this,t),this.handler_=e,this.defaultDelay_=i||0,this.scheduled_=-1,this.nextTime_=0}return babelHelpers.createClass(t,[{key:"isPending",value:function(){return-1!=this.scheduled_}},{key:"schedule",value:function(t){var e=this,i=t||this.defaultDelay_,n=s.timer.now()+i;return-1==this.scheduled_||n-this.nextTime_<-10?(-1!=this.scheduled_&&s.timer.cancel(this.scheduled_),this.nextTime_=n,this.scheduled_=s.timer.delay(function(){e.scheduled_=-1,e.nextTime_=0,e.handler_()},i),!0):!1}},{key:"cancel",value:function(){-1!=this.scheduled_&&(s.timer.cancel(this.scheduled_),this.scheduled_=-1)}}]),t}();i.Pass=n},{"./timer":17}],14:[function(t,e,i){function s(t){return(0,n.getService)(t,"platform",function(){return new r(t)})}Object.defineProperty(i,"__esModule",{value:!0}),i.platformFor=s;var n=t("./service"),r=function(){function t(e){babelHelpers.classCallCheck(this,t),this.win=e}return babelHelpers.createClass(t,[{key:"isIos",value:function(){return/iPhone|iPad|iPod/i.test(this.win.navigator.userAgent)}},{key:"isSafari",value:function(){return/Safari/i.test(this.win.navigator.userAgent)&&!this.isChrome()}},{key:"isChrome",value:function(){return/Chrome|CriOS/i.test(this.win.navigator.userAgent)}}]),t}();i.Platform=r;var a=s(window);i.platform=a},{"./service":15}],15:[function(t,e,i){function s(t,e,i){var s=t.services;s||(s=t.services={});var n=s[e];return n?n:s[e]=i(t)}function n(t,e){t.services&&(t.services[e]=null)}Object.defineProperty(i,"__esModule",{value:!0}),i.getService=s,i.resetServiceForTesting=n},{}],16:[function(t,e,i){function s(t){return t.charAt(0).toUpperCase()+t.slice(1)}function n(t,e){for(var i=0;i<p.length;i++){var s=p[i]+e;if(void 0!==t[s])return s}return""}function r(t,e,i){var r=d[e];if(!r||i){if(r=e,void 0===t[e]){var a=s(e),o=n(t,a);void 0!==t[o]&&(r=o)}i||(d[e]=r)}return r}function a(t,e,i,s,n){var a=r(t.style,e,n);a&&(t.style[a]=s?i+s:i)}function o(t,e,i){var s=r(t.style,e,i);return s?t.style[s]:void 0}function h(t,e){for(var i in e)a(t,i,e[i])}function l(t,e){void 0===e&&(e=!("none"!=t.style.display)),t.style.display=e?"":"none"}function u(t){return t+"px"}function c(t){return"string"==typeof t?"translateX("+t+")":"translateX("+u(t)+")"}function _(t,e){return"number"==typeof t&&(t=u(t)),void 0===e?"translate("+t+")":("number"==typeof e&&(e=u(e)),"translate("+t+","+e+")")}function v(t){return"scale("+t+")"}Object.defineProperty(i,"__esModule",{value:!0}),i.camelCaseToTitleCase=s,i.getVendorJsPropertyName=r,i.setStyle=a,i.getStyle=o,i.setStyles=h,i.toggle=l,i.px=u,i.translateX=c,i.translate=_,i.scale=v;var d=Object.create(null),p=["Webkit","webkit","Moz","moz","ms","O","o"]},{}],17:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(e){babelHelpers.classCallCheck(this,t),this.win=e,this.resolved_=Promise.resolve(),this.taskCount_=0,this.canceled_={},this.startTime_=this.now()}return babelHelpers.createClass(t,[{key:"now",value:function(){return Number(new Date)}},{key:"timeSinceStart",value:function(){return this.now()-this.startTime_}},{key:"delay",value:function(t,e){var i=this;if(!e){var s=function(){var e="p"+i.taskCount_++;return i.resolved_.then(function(){return i.canceled_[e]?void delete i.canceled_[e]:void t()}),{v:e}}();if("object"==typeof s)return s.v}return this.win.setTimeout(t,e)}},{key:"cancel",value:function(t){return"string"==typeof t?void(this.canceled_[t]=!0):void this.win.clearTimeout(t)}},{key:"promise",value:function(t,e){var i=this,s=null;return new Promise(function(n,r){s=i.delay(function(){s=-1,n(e)},t),-1==s&&r(new Error("Failed to schedule timer."))})["catch"](function(t){return-1!=s&&i.cancel(s),Promise.reject(t)})}},{key:"timeoutPromise",value:function(t,e){var i=this,s=null,n=new Promise(function(e,n){s=i.delay(function(){s=-1,n("timeout")},t),-1==s&&n(new Error("Failed to schedule timer."))})["catch"](function(t){return-1!=s&&i.cancel(s),Promise.reject(t)});return e?new Promise(function(t,i){n.then(t,i),e.then(t,i)}):n}}]),t}();i.Timer=s;var n=new s(window);i.timer=n},{}],18:[function(t,e,i){function s(t){var e=document.createElement("a");e.href=t;var i={href:e.href,protocol:e.protocol,host:e.host,hostname:e.hostname,port:"0"==e.port?"":e.port,pathname:e.pathname,search:e.search,hash:e.hash};return i.origin=e.origin&&"null"!=e.origin?e.origin:a(i),(0,h.assert)(i.origin,"Origin must exist"),i}function n(t,e){var i=s(t);return(0,h.assert)("https:"==i.protocol||/^(\/\/)/.test(t)||"localhost"==i.hostname||i.hostname.lastIndexOf(".localhost")==i.hostname.length-".localhost".length,'%s source must start with "https://" or "//" or be relative and served from https. Invalid value: %s',e,t),t}function r(t){var e=Object.create(null);if(!t)return e;(0==t.indexOf("?")||0==t.indexOf("#"))&&(t=t.substr(1));for(var i=t.split("&"),s=0;s<i.length;s++){var n=i[s],r=n.indexOf("="),a=void 0,o=void 0;-1!=r?(a=decodeURIComponent(n.substring(0,r)).trim(),o=decodeURIComponent(n.substring(r+1)).trim()):(a=decodeURIComponent(n).trim(),o=""),a&&(e[a]=o)}return e}function a(t){return"data:"!=t.protocol&&t.host?t.protocol+"//"+t.host:t.href}function o(t){var e=t.indexOf("#");return-1==e?t:t.substring(0,e)}Object.defineProperty(i,"__esModule",{value:!0}),i.parseUrl=s,i.assertHttpsUrl=n,i.parseQueryString=r,i.getOrigin=a,i.removeFragment=o;var h=t("./asserts")},{"./asserts":3}],19:[function(t,e,i){function s(t,e){var i=(0,u.parseQueryString)(t);for(var s in i)e[s]=i[s]}function n(t){return(0,h.getService)(t,"viewer",function(){return new f(t)})}Object.defineProperty(i,"__esModule",{value:!0}),i.parseParams_=s,i.viewerFor=n;var r=t("./observable"),a=t("./asserts"),o=t("./document-state"),h=t("./service"),l=t("./log"),u=t("./url"),c=t("./platform"),_="Viewer",v="__AMP__",d={NATURAL:"natural",VIRTUAL:"virtual",NATURAL_IOS_EMBED:"natural-ios-embed"};i.ViewportType=d;var p={VISIBLE:"visible",HIDDEN:"hidden"};i.VisibilityState=p;var f=function(){function t(e){var i=this;if(babelHelpers.classCallCheck(this,t),this.win=e,this.isEmbedded_=this.win.parent&&this.win.parent!=this.win,this.docState_=(0,o.documentStateFor)(window),this.isRuntimeOn_=!0,this.overtakeHistory_=!1,this.visibilityState_=p.VISIBLE,this.prerenderSize_=1,this.viewportType_=d.NATURAL,this.viewportWidth_=0,this.viewportHeight_=0,this.scrollTop_=0,this.paddingTop_=0,this.runtimeOnObservable_=new r.Observable,this.visibilityObservable_=new r.Observable,this.viewportObservable_=new r.Observable,this.historyPoppedObservable_=new r.Observable,this.messageDeliverer_=null,this.messageQueue_=[],this.params_={},this.win.name&&0==this.win.name.indexOf(v)&&s(this.win.name.substring(v.length),this.params_),this.win.location.hash&&s(this.win.location.hash,this.params_),l.log.fine(_,"Viewer params:",this.params_),this.isRuntimeOn_=!parseInt(this.params_.off,10),l.log.fine(_,"- runtimeOn:",this.isRuntimeOn_),this.overtakeHistory_=parseInt(this.params_.history,10)||this.overtakeHistory_,l.log.fine(_,"- history:",this.overtakeHistory_),this.visibilityState_=this.params_.visibilityState||this.visibilityState_,l.log.fine(_,"- visibilityState:",this.visibilityState_),this.prerenderSize_=parseInt(this.params_.prerenderSize,10)||this.prerenderSize_,l.log.fine(_,"- prerenderSize:",this.prerenderSize_),this.viewportType_=this.params_.viewportType||this.viewportType_,this.viewportType_==d.NATURAL&&this.isEmbedded_&&c.platform.isIos()&&(this.viewportType_=d.NATURAL_IOS_EMBED),l.log.fine(_,"- viewportType:",this.viewportType_),this.viewportWidth_=parseInt(this.params_.width,10)||this.viewportWidth_,l.log.fine(_,"- viewportWidth:",this.viewportWidth_),this.viewportHeight_=parseInt(this.params_.height,10)||this.viewportHeight_,l.log.fine(_,"- viewportHeight:",this.viewportHeight_),this.scrollTop_=parseInt(this.params_.scrollTop,10)||this.scrollTop_,l.log.fine(_,"- scrollTop:",this.scrollTop_),this.paddingTop_=parseInt(this.params_.paddingTop,10)||this.paddingTop_,l.log.fine(_,"- padding-top:",this.paddingTop_),this.docState_.onVisibilityChanged(function(){i.visibilityObservable_.fire()}),this.isEmbedded_){var n=(0,u.removeFragment)(this.win.location.href);n!=this.win.location.href&&this.win.history.replaceState&&(this.win.history.replaceState({},"",n),l.log.fine(_,"replace url:"+this.win.location.href))}}return babelHelpers.createClass(t,[{key:"getParam",value:function(t){return this.params_[t]}},{key:"isEmbedded",value:function(){return this.isEmbedded_}},{key:"isRuntimeOn",value:function(){return this.isRuntimeOn_}},{key:"toggleRuntime",value:function(){this.isRuntimeOn_=!this.isRuntimeOn_,l.log.fine(_,"Runtime state:",this.isRuntimeOn_),this.runtimeOnObservable_.fire(this.isRuntimeOn_)}},{key:"onRuntimeState",value:function(t){return this.runtimeOnObservable_.add(t)}},{key:"isOvertakeHistory",value:function(){return this.overtakeHistory_}},{key:"getVisibilityState",value:function(){return this.visibilityState_}},{key:"isVisible",value:function(){return this.visibilityState_==p.VISIBLE&&!this.docState_.isHidden()}},{key:"getPrerenderSize",value:function(){return this.prerenderSize_}},{key:"getViewportType",value:function(){return this.viewportType_}},{key:"getViewportWidth",value:function(){return this.viewportWidth_}},{key:"getViewportHeight",value:function(){return this.viewportHeight_}},{key:"getScrollTop",value:function(){return this.scrollTop_}},{key:"getPaddingTop",value:function(){return this.paddingTop_}},{key:"onVisibilityChanged",value:function(t){return this.visibilityObservable_.add(t)}},{key:"onViewportEvent",value:function(t){return this.viewportObservable_.add(t)}},{key:"onHistoryPoppedEvent",value:function(t){return this.historyPoppedObservable_.add(t)}},{key:"postDocumentReady",value:function(t,e){this.sendMessage_("documentLoaded",{width:t,height:e},!1)}},{key:"postDocumentResized",value:function(t,e){this.sendMessage_("documentResized",{width:t,height:e},!1)}},{key:"requestFullOverlay",value:function(){return this.sendMessage_("requestFullOverlay",{},!0)}},{key:"cancelFullOverlay",value:function(){return this.sendMessage_("cancelFullOverlay",{},!0)}},{key:"postPushHistory",value:function(t){return this.sendMessage_("pushHistory",{stackIndex:t},!0)}},{key:"postPopHistory",value:function(t){return this.sendMessage_("popHistory",{stackIndex:t},!0)}},{key:"receiveMessage",value:function(t,e,i){return"viewport"==t?(void 0!==e.width&&(this.viewportWidth_=e.width),void 0!==e.height&&(this.viewportHeight_=e.height),void 0!==e.paddingTop&&(this.paddingTop_=e.paddingTop),void 0!==e.scrollTop&&(this.scrollTop_=e.scrollTop),void this.viewportObservable_.fire()):"historyPopped"==t?(this.historyPoppedObservable_.fire({newStackIndex:e.newStackIndex}),Promise.resolve()):"visibilitychange"==t?(void 0!==e.state&&(this.visibilityState_=e.state),void 0!==e.prerenderSize&&(this.prerenderSize_=e.prerenderSize),l.log.fine(_,"visibilitychange event:",this.visibilityState_,this.prerenderSize_),this.visibilityObservable_.fire(),Promise.resolve()):void l.log.fine(_,"unknown message:",t)}},{key:"setMessageDeliverer",value:function(t){var e=this;if((0,a.assert)(!this.messageDeliverer_,"message deliverer can only be set once"),this.messageDeliverer_=t,this.messageQueue_.length>0){var i=this.messageQueue_.slice(0);this.messageQueue_=[],i.forEach(function(t){e.messageDeliverer_(t.eventType,t.data,!1)})}}},{key:"sendMessage_",value:function(t,e,i){if(this.messageDeliverer_)return this.messageDeliverer_(t,e,i);for(var s=null,n=0;n<this.messageQueue_.length;n++)if(this.messageQueue_[n].eventType==t){s=this.messageQueue_[n];break}return s?s.data=e:this.messageQueue_.push({eventType:t,data:e}),i?Promise.resolve():void 0}}]),t}();i.Viewer=f},{"./asserts":3,"./document-state":4,"./log":9,"./observable":12,"./platform":14,"./service":15,"./url":18}],20:[function(t,e,i){function s(t){return(0,n.getService)(t,"vsync",function(){return new h(t)})}Object.defineProperty(i,"__esModule",{value:!0}),i.vsyncFor=s;var n=t("./service"),r=t("./log"),a=t("./timer"),o=t("./viewer"),h=function(){function t(e){babelHelpers.classCallCheck(this,t),this.win=e,this.raf_=this.getRaf_(),this.tasks_=[],this.states_=[],this.scheduled_=!1}return babelHelpers.createClass(t,[{key:"run",value:function(t,e){var i=this;if(!(0,o.viewerFor)(this.win).isVisible())return void r.log.fine("VSYNC","Did not schedule a vsync request, because document was invisible.");var s=e||{};this.tasks_.push(t),this.states_.push(s),this.scheduled_||(this.scheduled_=!0,this.raf_(function(){i.runScheduledTasks()}))}},{key:"runScheduledTasks",value:function(){this.scheduled_=!1;var t=this.tasks_,e=this.states_;this.tasks_=[],this.states_=[];for(var i=0;i<t.length;i++)t[i].measure&&t[i].measure(e[i]);for(var i=0;i<t.length;i++)t[i].mutate&&t[i].mutate(e[i])}},{key:"mutate",value:function(t){this.run({mutate:t})}},{key:"measure",value:function(t){this.run({measure:t})}},{key:"createTask",value:function(t){var e=this;return function(i){e.run(t,i)}}},{key:"runMutateSeries",value:function(t,e){var i=this;return new Promise(function(s,n){var r=a.timer.now(),o=0,h=i.createTask({mutate:function(i){var l=a.timer.now()-r,u=t(l,l-o,i);u?e&&l>e?n("timeout"):(o=l,h(i)):s()}});h({})})}},{key:"getRaf_",value:function(){var t=this,e=this.win.requestAnimationFrame||this.win.webkitRequestAnimationFrame;if(e)return e.bind(this.win);var i=0;return function(e){var s=(new Date).getTime(),n=Math.max(0,16-(s-i));i=s+n,t.win.setTimeout(e,n)}}}]),t}();i.Vsync=h},{"./log":9,"./service":15,"./timer":17,"./viewer":19}]},{},[1])});
//# sourceMappingURL=amp-lightbox-0.1.js.map